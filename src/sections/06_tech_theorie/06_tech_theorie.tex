\section{Peer-To-Peer Sprachübertragung}

Dieses Kapitel beschreibt die Funktionsweise von WebRTC und bildet die theoretische Grundlage dafür, wie Peer-To-Peer Sprachübertragung mit WebRTC in einem Praxisrufsystem eingesetzt werden kann.

\subsection{Verbindungsprotokolle}

Im Folgenden werden die zentralen Kommunikationsprotokolle beschrieben, welche von WebRTC verwendet werden.
Die wichtigsten Protokolle im WebRTC Umfeld sind das Session Description Protocol und das Interactive Connectivity Establishment.

Das Session Description Protocol (SDP) dient als Beschreibung einer Verbindung über welche Multimediadaten wie Audio oder Video übertragen werden~\cite{rfc_4566_sdp}.
Diese Beschreibung beinhaltet Metainformationen zu einer Verbindung.
Dazu gehören unter anderem Auflösung, Format sowie Verschlüsselung und Codierung der zu übertragenden Daten~\cite{mozilla_webRTC_protocols}.
WebRTC verwendet SDP, um zu Beschreiben welche Art von Daten mit einer Verbindung übertragen werden und wie diese verarbeitet werden können~\cite{webrtc_spec}.
Um eine Verbindung mit WebRTC aufzubauen, müssen die Teilnehmer der Verbindung SDP Informationen austauschen.
Dieser Austausch bildet den ersten Teil an Signalmeldungen, welche über die Signaling Instanz ausgetauscht werden müssen.

Das Protokoll Interactive Connectivity Establishment (ICE) ermöglicht es, Netzwerkverbindungen zwischen Endgeräten aufzubauen.
Es wird verwendet, um eine möglichst direkte Netzwerkverbindung zwischen zwei Teilnehmern herzustellen.
Zu diesem Zweck tauschen die Teilnehmenden sogenannte ICE Candidates aus.
Ein ICE Candidate beschreibt eine mögliche Verbindung, über welche die Kommunikation stattfinden kann~\cite{rfc_8445_ice}.
ICE wird in WebRTC verwendet, um die Netzwerkverbindung zwischen zwei Teilnehmern aufzubauen~\cite{mozilla_webRTC_protocols}.
Der Austausch von ICE Candidates bildet den zweiten Teil an Signalmeldungen, welche über die Signaling Instanz ausgetauscht werden müssen~\cite{webrtc_spec}.

Das ICE-Protokoll kann die Protokolle ''Session Traversal Utilities for NAT'' (STUN) und ''Traversal Using Relays around NAT'' (TURN) verwenden.
Beide Protokolle erlauben es in IP-Netzwerken hinter Firewalls und Network Address Translators (NAT) Peer-To-Peer Verbindungen aufzubauen~\cite{rfc_8445_ice}.
NAT wird verwendet, wenn die IP-Adresse eines Endgerätes im lokalen Netzwerk nicht von ausserhalb dieses Netzwerks erreichbar ist.
NAT ermöglicht es, solchen Endgeräten mit Zielen ausserhalb des privaten Netzwerkes zu kommunizieren~\cite{rfc_2663_nat}.
Das Protokoll STUN erlaubt den Umgang mit NAT, indem es Clients erlaubt, die eigene öffentliche IP-Adresse zu ermitteln.
Um dies zu ermöglichen wird ein STUN-Server ausserhalb des lokalen Netzwerkes angefragt.
Aufgrund der Adresse, welche dieser Server zurückliefert, kann ein Ice Candidate erstellt werden~\cite{rfc_8445_ice}.
Mit dem Protokoll TURN ist es möglich Verbindungen aufzubauen, wenn weitere Restriktionen vorhanden sind, die Netzwerkverbindungen einschränken.
Dabei dient ein TURN-Server als vermittelnde Instanz, welche auszutauschenden Daten zwischen den Endgeräten weiterleitet~\cite{webRTC_TURN}.

Die Protokolle STUN und TURN sind nur notwendig, wenn keine direkte Verbindung zwischen den beteiligten Endgeräten möglich sind.
Wenn alle beteiligten Endgeräte im selben lokalen Netzwerk sind und direkte Verbindungen aufbauen können, kann ein ICE Candidate mit der lokalen Adresse der Beteiligten erstellt werden~\cite{webRTC_TURN}.

\subsection{Verbindungsaufbau}

Die Protokolle SDP und ICE werden in Endgeräten verwendet, um Verbindungen aufzubauen.
Als zentrale Schnittstelle für diese Protokolle im Endgerät definiert der Standard das Interface RTCPeerConnection.
Diese Schnittstelle repräsentiert die Peer-To-Peer Verbindung zu einem anderen Endgerät.
Sie muss sowohl auf dem Gerät, welches einen Anruf startet, als auch auf dem Zielgerät initialisiert werden~\cite{webrtc_spec}.

Die WebRTC Bibliothek für iOS implementiert dieses Interface.
Es bietet die Möglichkeit, eine RTCPeerConnection für die gewünschte Übertragung zu initialisieren.
Nach dieser Initialisierung ist noch keine Verbindung zu einem anderen Endgerät aufgebaut.
Es ist ausschliesslich ein lokales Verbindungsobjekt initialisiert.
Aus diesem Verbindungsobjekt können die nötigen SDP Informationen generiert werden.
Diese Informationen müssen über die Signaling Instanz an das Zielgerät übertragen werden.
Die Signalmeldung, welche SDP Informationen des Initiators der Verbindung überträgt, stellt ein Offer-Signal dar.
Dieses kann darauf die RTCPeerConnection auf seiner Seite initialisieren und entsprechende SDP Informationen über die Signaling Instanz zurücksenden.
Die Signalmeldung, welche die SDP Informationen des Verbindungsziels an den Sender übermittelt, stellt ein Answer-Signal dar.

Damit die Peer-To-Peer Verbindung aufgebaut werden kann, müssen die ICE Candidates gemäss dem ICE Protokoll ermittelt werden.
Wenn eine direkte Verbindung zwischen beiden beteiligten Geräten aufgebaut werden kann, sind keine weiteren Anfragen notwendig.
Ein ICE Candidate für die direkte Verbindung kann erstellt und über die Signaling Instanz geteilt werden.
Ist keine direkte Verbindung möglich, müssen mögliche ICE Candidates von einem ICE Server ermittelt werden.
Dazu können die Protokolle STUN oder TURN eingesetzt werden.
Die Abfragen an den ICE Server werden von der Implementation der RTCPeerConnection übernommen.
Verfügbare ICE Server und das für die Abfrage zu verwendende Protokoll müssen bei Initialisierung der RTCPeerConnection mitgegeben werden.
ICE Candidates werden von beiden Teilnehmern erstellt und über die Signaling Instanz geteilt.
Dieser Prozess wird wiederholt, bis sich beide Teilnehmer auf einen ICE Candidate geeinigt haben.

\subsection{Signaling}

Der Aufbau von Peer-To-Peer Sprachverbindungen mit WebRTC erfordert das Austauschen on Signalmeldungen.
Dabei sind wie in Kapitel 6.2 beschrieben mindestens die drei Signale Offer, Answer und Ice Candidate notwendig.
Um diesen Austausch zu ermöglichen ist eine zentrale Signaling Instanz notwendig.
Diese muss Signale entgegennehmen und an relevante Empfänger weiterleiten können~\cite{webrtc_spec}.

Der WebRTC Standard schreibt nicht, vor wie eine Signaling Instanz umgesetzt werden muss.
Er definiert einzig, welchen Inhalt Signale für den Verbindungsaufbau beinhalten müssen und wie dieser Inhalt verarbeitet werden muss~\cite{webrtc_spec}.
Konzept und Funktionsweise der Signaling Instanz und Signalmeldungen in Praxisruf werden in Kapitel 7 beschrieben.

\subsection{Sicherheit}

Bei Sprachverbindungen mit WebRTC gibt es zwei sicherheitskritische Kanäle.
Erstens muss der Kanal, über welchen Signalmeldungen ausgetauscht werden gesichert sein.
Nur Berechtigte dürfen Signalmeldungen versenden und empfangen.
Dazu muss die Identität der Teilnehmer, die Signalmeldungen austauschen verifiziert werden.
Aussenstehende und nicht Berechtigte dürfen den Inhalt von Signalmeldungen nicht lesen können~\cite{rfc_8827_webRTC_SecurityArchitecture}.
Die Implementierung dieser Mechanismen muss vom Anbieter der Signaling Instanz umgesetzt werden~\cite{webrtc_spec}.

Zweitens muss die Verbindung über welche Echtzeitdaten ausgetauscht werden gesichert sein.
Diese Datenverbindungen werden über das Protokoll Datagram Transport Layer Security (DTLS) verschlüsselt.
Bevor Daten über eine Verbindung ausgetauscht werden, wird pro Übertragungskanal ein DTLS-Handshake ausgeführt.
Über diesen Handshake werden die nötigen Schlüsselinformationen ausgetauscht.
Diese Schlüssel werden anschliessend für sichere Datenübertragung über das Protokoll ''Secure Real-Time Transport'' verwendet~\cite{rfc_8827_webRTC_SecurityArchitecture}.
Die Implementierung dieser Mechanismen muss von der Bibliothek, welcher den Standard implementiert umgesetzt werden~\cite{webrtc_spec}.

\subsection{Unicast, Multi-Cast, Broadcast}

Dieses Kapitel beschreibt, der Verbindungsaufbau von Peer-To-Peer Verbindungen mit WebRTC als \\Uni-, Multi- und Broadcast in einem cloudbasierten Praxisrufsystem umgesetzt werden kann.

WebRTC unterstützt ausschliesslich Peer-To-Peer Verbindungen.
Einzelne Verbindungen können mit WebRTC immer nur zwischen genau zwei Teilnehmern bestehen.
Gleichzeitig haben Signalmeldungen immer nur genau einen Empfänger.
Aus der Sicht von WebRTC sind damit ausschliesslich Unicast Verbindungen möglich.

Um Multi- und Broadcast Signale zu erlauben, muss auf Applikationsstufe eingegriffen werden.
Es ist mit WebRTC nicht möglich, eine Verbindung zwischen mehr als zwei Teilnehmern aufzubauen.
Es ist hingegen möglich, mehrere Verbindungen gleichzeitig aufzubauen und mit allen Teilnehmern gleichzeitig zu kommunizieren~\cite{webrtc_mesh}.
Dies bedeutet, dass der Verbindungsaufbau wie in Kapitel 6.2 beschrieben für jedes Ziel einzeln ausgeführt werden muss.

Verbindung zu mehreren und/oder allen Teilnehmern können als 1:n Verbindungen umgesetzt werden.
Dazu müssen die relevanten Teilnehmer durch die Applikation vor Verbindungsaufbau identifiziert werden.
Anschliessend wird der Verbindungsaufbau auf der Seite des Initiators für jeden Empfänger wiederholt.
Aus Sicht des Empfängers handelt es sich dabei um eine Unicast Verbindung.
Für Empfänger gibt es damit keinen Unterschied zwischen 1:1 und 1:n Verbindungen.
Bei einer solchen Verbindung kann der Initiator der Verbindung mit allen Empfängern kommunizieren.
Jeder Empfänger kann allerdings nur mit dem Initiator kommunizieren.
Eine Kommunikation zwischen einzelnen Empfängern ist in dieser Form nicht möglich.

Kommunikation zwischen allen Verbindungsteilnehmern wird möglich, wenn n:n Verbindungen verwendet werden.
Dabei baut jeder Teilnehmer eine Verbindung zu jedem anderen Teilnehmer auf~\cite{webrtc_mesh}.
Im Rahmen dieser Arbeit sind lediglich 1:n Verbindungen gefordert.
Konzepte und Umsetzung für n:n Verbindungen werden hier deshalb nicht weiter behandelt.

\clearpage
